---
title: "Analiza utakmica Bundeslige od sezone početka 2014-15 do 01.02.2017."
author: "Alen Murtic, Mario Slatinac"
date: '5 veljače 2017 '
output: pdf_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
source("./../R/BL_data_adjust.R")
ggpairsPlt <- ggpairs(blreduced, lower=list(combo=wrap("facethist", binwidth=1)))
ggsave(plot = ggpairsPlt, filename = './../figures/BL/ggpairs.png')
```

# Upoznavanje s podatkovnim skupom

Podatkovni skup preuzet je sa stranice http://www.football-data.co.uk/ te je detaljnije opisan u službenim uputama http://www.football-data.co.uk/notes.txt.

Najprije pozivamo naredbe summary, glimpse i ggpairs kako bi vidjeti osnovne podatke o varijablama.

```{r cars}
summary(bl)
#glimpse(bl)
ggpairsPlt
```
Zatim ćemo provjeriti koliko je različitih klubova igralo u Bundesligi u vremenskom periodu navedene tri sezone. Maksimalan mogući broj bio bi 18 + 3 + 3 = 24, jer svake godine iz lige mogu ispasti tri kluba i biti zamijenjeni novim trima klubovima.

```{r}
teams <- unique(as.character(bl$HomeTeam))
cat("U ligi je u navedene tri sezone nastupilo ",length(teams)," različitih klubova. Oni su: ")
teams
```

# Analiza osnovnih podataka

## Analiza broja golova i rezultata

U sljedećih nekoliko grafova bit će prikazan broj golova domaćina/gosta u odnosu na ishod utakmice. Dobiveni grafovi imaju smisla budući da je postoji prednost domaćeg terena, a najmanje je vjerojatno da obje momčadi zabiju jednake broj golova.

A predstavlja pobjedu gosta (away), D neodlučen rezultat (draw), a H pobjedu domaćina (home).

Prilično očita informacija na grafovima je da bilo koja, domaća ili gostujuća, momčad mora zabiti više od 1 gola da joj najvjerojatniji ishod ne bi bio poraz. I to semantički ima smisla jer je Bundesliga jedna od najatraktivnijih europskih liga po broj golova. 

```{r pressure}
knitr::opts_chunk$set(echo = TRUE)
ggplot(bl, aes(x = FTR)) + geom_bar(aes(fill = FTR)) +
  labs(x = "Rezultat utakmice", y = "Broj slucajeva", fill = "Rezultat utakmice")
ggplot(bl, aes(x = FTR)) + geom_bar(aes(fill = FTHG)) +
  labs(x = "Rezultat utakmice", y = "Broj slucajeva", fill = "Golova domacina")
ggplot(bl, aes(x = FTR)) + geom_bar(aes(fill = FTAG)) +
  labs(x = "Rezultat utakmice", y = "Broj slucajeva", fill = "Golova gosta")
ggplot(bl, aes(x = FTHG)) + geom_bar(aes(fill = FTR)) +
  labs(x = "Golova domacina", y = "Broj slucajeva", fill = "Rezultat utakmice")
ggplot(bl, aes(x = FTAG)) + geom_bar(aes(fill = FTR)) +
  labs(x = "Golova gosta", y = "Broj slucajeva", fill = "Rezultat utakmice")
```

Nakon čega dobivamo konkretne brojke pojavljivanja pojedinog ishoda utakmice:
```{r}
select(bl, FTR) %>% group_by(FTR) %>% summarize(Count = n()) -> results
results
```

```{r}
bl$FTHG <- as.numeric(bl$FTHG)
bl$FTAG <- as.numeric(bl$FTAG)

group_by(bl, HomeTeam) %>% summarize(homeScored = mean(FTHG), homeConceded = mean(FTAG), hgames = n(), hscored = sum(FTHG), hconceded = sum(FTAG)) %>% arrange(desc(homeScored)) %>% as.data.frame() -> homeTeamGoals

ggplot(homeTeamGoals, aes(x = homeScored, y = homeConceded)) + geom_text(aes(label = HomeTeam),hjust=0, vjust=0) + scale_x_continuous(limits = c(1.8, 4.5)) + geom_point()

group_by(bl, AwayTeam) %>% summarize(awayScored = mean(FTAG), awayConceded = mean(FTHG), agames = n(), awscored = sum(FTAG), awconceded = sum(FTHG)) %>% arrange(desc(awayScored)) %>% as.data.frame() -> awayTeamGoals

ggplot(awayTeamGoals, aes(x = awayScored, y = awayConceded)) + geom_text(aes(label = AwayTeam),hjust=0, vjust=0) + scale_x_continuous(limits = c(1.55, 3.2)) + geom_point()

```



